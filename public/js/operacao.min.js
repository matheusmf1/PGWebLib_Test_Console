
(()=>{const check=setInterval(async()=>{await fetch('/main/console/loading',{method:'GET',headers:{'Content-Type':'application/json'},mode:'cors'}).then((response)=>{if(response.status===200)
return response.json();}).then((resp)=>{console.log('trigger ',resp);if(resp.trigger){let sectionNode=document.getElementById('comprovante__container');sectionNode.innerHTML="";sectionNode.className='comprovante__container comprovante__container--active';let mainDiv=document.createElement('div');mainDiv.className="spinner__container";mainDiv.id="spinner";let innerDiv=document.createElement('div');innerDiv.className="spinner type1";let span=document.createElement('span');span.innerHTML='Aguarde...';innerDiv.appendChild(span);mainDiv.appendChild(innerDiv);sectionNode.appendChild(mainDiv);clearInterval(check);}}).catch(error=>{console.log('Error on addSpinner ',error);})},2000);})();

(()=>{const reloadAuth=()=>{setInterval(()=>{location.reload(true);},3600000);}});

(()=>{const update=setInterval(async()=>{await fetch('/main/console/resultado',{method:'GET',headers:{'Content-Type':'application/json'},mode:'cors'}).then((response)=>{if(response.status===200)
return response.json();}).then((resp)=>{console.log('Result',resp);if(resp.comprovante){let spinner=document.getElementById('spinner');if(spinner)
spinner.classList.add('loaded');let sectionNode=document.getElementById('comprovante__container');sectionNode.innerHTML="";sectionNode.className='comprovante__container comprovante__container--active';let ulNode=document.createElement('ul');ulNode.className='comprovante__lista';resp.comprovante.forEach((c)=>{let liNode=document.createElement('li');liNode.classList='comprovante__lista--titulo';liNode.innerHTML=Object.keys(c).toString().replace(/_/g,' ');divNode=document.createElement('div');divNode.classList='comprovante__lista--conteudo';divNode.innerHTML=Object.values(c);liNode.appendChild(divNode);ulNode.appendChild(liNode);});sectionNode.appendChild(ulNode);clearInterval(update);}}).catch((err)=>{console.log('Erro Fetch',err);});},10000);})();

(()=>{const status=setInterval(async()=>{await fetch('/main/console/status',{method:'GET',headers:{'Content-Type':'application/json'},mode:'cors'}).then((response)=>{return response.json();}).then((resp)=>{console.log('Status',resp);if(resp.erro){let spinner=document.getElementById('spinner');if(spinner)
spinner.classList.add('loaded');resp.erro.forEach((c)=>{alert(Object.values(c).toString());});clearInterval(status);}}).catch((err)=>{console.log('Erro Fetch',err);});},5000);})();

(()=>{const validation=setInterval(async()=>{await fetch('/main/console/validacao',{method:'GET',headers:{'Content-Type':'application/json'},mode:'cors'}).then((response)=>{return response.json();}).then((resp)=>{console.log('validacao',resp);if(resp.validacao){let spinner=document.getElementById('spinner');if(spinner)
spinner.classList.add('loaded');let sectionNode=document.getElementById('validacao__container');sectionNode.innerHTML="";sectionNode.className='validacao__container validacao__container--active';let divOption=document.createElement('div');divOption.className="table__option";let saveOp=document.createElement('a');saveOp.className="table__option--text";saveOp.id="saveOp";saveOp.innerHTML="Salvar";let cleanOp=document.createElement('a');cleanOp.className="table__option--text";cleanOp.innerHTML="Limpar Dados";cleanOp.href="";divOption.appendChild(saveOp);divOption.appendChild(cleanOp);let tableNode=document.createElement('table');tableNode.className='table__container table_container--shadow';let thead=document.createElement('thead');let trTitle=document.createElement('tr');trTitle.className='table__title';const titles=["PWINFO's",'VALIDAÇÃO'];titles.forEach((title)=>{let thTitle=document.createElement('th');thTitle.className='table__title--border';thTitle.innerHTML=title;trTitle.appendChild(thTitle);});thead.appendChild(trTitle);let tbody=document.createElement('tbody');let valData=[];resp.validacao.forEach(item=>{trContent=document.createElement('tr');trContent.className='table__content';let tdContentID=document.createElement('td');let tdContent=document.createElement('td');if(Object.keys(item)=='isValid'&&Object.values(item)=='false'){tdContentID.className='table__content--border table__content--left table__content--invalid';tdContent.className='table__content--border table__content--right table__content--invalid';}else if(Object.keys(item)=='isValid'&&Object.values(item)=='true'){tdContentID.className='table__content--border table__content--left table__content--valid';tdContent.className='table__content--border table__content--right table__content--valid';}else{tdContentID.className='table__content--border table__content--left';tdContent.className='table__content--border table__content--right';}
tdContentID.innerHTML=Object.keys(item);tdContent.innerHTML=Object.values(item);valData.push(item);trContent.appendChild(tdContentID);trContent.appendChild(tdContent);tbody.appendChild(trContent);});tableNode.appendChild(thead);tableNode.appendChild(tbody);sectionNode.appendChild(divOption);sectionNode.appendChild(tableNode);clearInterval(validation);const inputs=document.querySelectorAll('input');inputs.forEach((textField)=>{textField.addEventListener('keyup',(event)=>{let label=textField.previousElementSibling;if(event.target.value==='')
label.classList.remove('active');else
label.classList.add('active');});textField.addEventListener('blur',(event)=>{let label=textField.previousElementSibling;if(event.target.value==='')
label.classList.remove('active');});});const postValidations=document.getElementById('saveOp').addEventListener('click',async()=>{const divModal=document.createElement('div');divModal.setAttribute('id','newProj');divModal.className='modal__container modal__container--active';divModal.setAttribute('role','dialog');divModal.setAttribute('aria-hidden','true');const divContent=document.createElement('div');divContent.className='modal__dialog modal__content modal__content--active';const h1Title=document.createElement('h1');h1Title.innerHTML="Salvar Validação";divContent.appendChild(h1Title);const formNode=document.createElement('form');formNode.setAttribute('action','/main/validation');formNode.setAttribute('method','post');formNode.className='form__ProjProject';const divTitle=document.createElement('div');divTitle.className='form__ProjContent';const label=document.createElement('label');label.className='form__ProjContent--label';label.innerHTML='Nome';const input=document.createElement('input');input.setAttribute('type','text');input.setAttribute('autocomplete','off');input.setAttribute('name','title');input.required=true
input.className='form__ProjContent--input';divTitle.appendChild(label);divTitle.appendChild(input);formNode.appendChild(divTitle);const divDescription=document.createElement('div');divDescription.className='form__ProjContent';const selectProj=document.createElement('select');selectProj.name="projectTitle";selectProj.id="selectProj";await fetch('/main/projs',{method:'GET'}).then((response)=>{return response.json();}).then((resp)=>{console.log('projects',resp);resp.projects.forEach((proj)=>{let option=document.createElement('option');option.value=proj.title;option.innerHTML=proj.title;selectProj.appendChild(option);});divDescription.appendChild(selectProj);formNode.appendChild(divDescription);}).catch((err)=>{console.log('Erro Fetch',err);});const jsonData=document.createElement('input');jsonData.name="info";jsonData.style="display: none";jsonData.value=JSON.stringify(valData);formNode.appendChild(jsonData);const button=document.createElement('button');button.className='button-login button-block';button.setAttribute('type','submit');button.setAttribute('id','submitBtn');button.innerHTML='Adicionar';const anchor=document.createElement('a');anchor.href='';anchor.className='modal__close demo-close modal__anchor';anchor.innerHTML=`<svg viewBox="0 0 24 24">
        <path d="M19 6.41l-1.41-1.41-5.59 5.59-5.59-5.59-1.41 1.41 5.59 5.59-5.59 5.59 1.41 1.41 5.59-5.59 5.59 5.59 1.41-1.41-5.59-5.59z"></path>
        <path d="M0 0h24v24h-24z" fill="none"></path>
      </svg`
formNode.appendChild(button);formNode.appendChild(anchor);divContent.appendChild(formNode);divModal.appendChild(divContent);sectionNode.appendChild(divModal);const inputs=document.querySelectorAll('input');inputs.forEach((textField)=>{textField.addEventListener('keyup',(event)=>{let label=textField.previousElementSibling;if(event.target.value==='')
label.classList.remove('active');else
label.classList.add('active');});textField.addEventListener('blur',(event)=>{let label=textField.previousElementSibling;if(event.target.value==='')
label.classList.remove('active');});});});}}).catch((err)=>{console.log('Erro Fetch',err);});},10000);})();

(()=>{let dataFile='';const chooseFile=document.getElementById('chooseFile');const fileDisplayArea=document.getElementById('informationArea');const submitBtn=document.getElementById('inputData');chooseFile.addEventListener('change',(e)=>{const file=chooseFile.files[0];const textType=/json.*/;if(file.type.match(textType)){const reader=new FileReader();reader.onload=(e)=>{fileDisplayArea.innerText=reader.result;dataFile=reader.result;}
reader.readAsText(file);}else{fileDisplayArea.innerText="Arquivo não suportado!"}});submitBtn.addEventListener("click",()=>{const fileData=JSON.parse(dataFile);submitBtn.value=JSON.stringify(fileData);},false);submitBtn.addEventListener('mousedown',()=>{let checkArea=document.getElementById('informationArea').firstElementChild;if(checkArea.localName==="br")
submitBtn.disabled=false;if(checkArea.localName==="p"){submitBtn.disabled=true;alert('Selecione algum arquivo');submitBtn.disabled=false;}});})();